// Copyright (c) 2012 CoNarrative - http://www.conarrative.com/
// License: MIT (http://www.opensource.org/licenses/mit-license.php)
// GluJS version 1.1.0
null!=window.glu&&(window.existingGlu=glu),glu={testMode:!1,mtypeRegistry:{},bindingDirectiveRegistry:{},createViewmodelAndView:function(config,asWindow,viewMode){var vm;vm=config._private&&config._private.isInstantiated?config:glu.model(config);var viewName=viewMode?vm.viewmodelName+"_"+viewMode:vm.viewmodelName,viewSpec=this.getViewSpec(vm,null,viewName);if(glu.isString(viewSpec))throw viewSpec;vm._private&&!vm._private.isInitialized&&vm.init();var view=glu.viewFromSpec(vm,viewSpec);return view},splitNs:function(vmName){var parts=vmName.split(".");return{className:parts[parts.length-1],namespace:parts.slice(0,parts.length-1).join(".")}},getViewSpec:function(vm,ns,viewmodelName,configOverlay,defaults){ns=ns||vm.ns,viewmodelName=viewmodelName||vm.viewmodelName,configOverlay=configOverlay||{};var viewName=viewmodelName;glu.log.debug("Creating view "+ns+"."+viewName);var nsSubObj=glu.namespace(ns+"."+glu.conventions.viewNs),viewSpec=nsSubObj[viewName];if(!viewSpec||glu.isFunction(viewSpec)){var factory=viewSpec||nsSubObj[viewName+"Factory"];if(void 0===factory)return"unable to find view config spec for "+viewName;configOverlay.vm=vm,viewSpec=factory(configOverlay),delete configOverlay.vm}else viewSpec=glu.deepApply({},viewSpec);if(viewSpec.parentLayout){var layoutName=viewSpec.parentLayout,layoutFactory=nsSubObj[layoutName+"Factory"];if(void 0===layoutFactory)return"Could not find parent layout "+layoutName;if(viewSpec.vm=vm,viewSpec=layoutFactory(viewSpec),delete viewSpec.vm,void 0===viewSpec)return"Expected layout factory "+layoutName+" to return a view specification"}return configOverlay&&glu.apply(viewSpec,configOverlay),defaults&&glu.applyIf(viewSpec,defaults),viewSpec},view:function(vm,ns,className,configOverlay,defaults,parent){var viewSpec=this.getViewSpec(vm,ns,className,configOverlay,defaults,parent);if(glu.isString(viewSpec))throw viewSpec;var view=glu.viewFromSpec(vm,viewSpec,parent);return view},viewFromSpec:function(vm,viewSpecBase,parent){var viewSpec=viewSpecBase,view=glu.provider.view(vm,viewSpec,parent);return view._bindings=view._bindings||[],view._bindings.viewmodel=vm,view},getCmp:function(id){return glu.provider.getCmp(id)},S4:function(){return(0|65536*(1+Math.random())).toString(16).substring(1)},guid:function(prefix){return(prefix?prefix:"a")+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()},isArray:function(value){return"[object Array]"===Object.prototype.toString.apply(value)},isObject:function(target){return!!target&&"[object Object]"===Object.prototype.toString.call(target)},isDate:function(value){return"[object Date]"===Object.prototype.toString.apply(value)},isFunction:function(target){return"function"==typeof target},isString:function(target){return"string"==typeof target},isNumber:function(target){return"number"==typeof target},isInstantiated:function(target){return target._private},namespaces:{},namespace:function(str){for(var tokens=str.split("."),root=window,i=0;tokens.length>i;i++){var token=tokens[i],existingChild=root[token];void 0===existingChild&&(existingChild={},root[token]=existingChild),root=existingChild}return this.namespaces[str]=root,root},walk:function(str,root){if(null==str)return null;var tokens=str.split(".");root=root||window;for(var i=0;tokens.length>i;i++){var token=tokens[i],existingChild=root[token];if(void 0===existingChild)return null;root=existingChild}return root},apply:function(obj,config,defaults){return glu.provider.apply(obj,config,defaults)},applyIf:function(obj,config,defaults){return Ext.applyIf(obj,config,defaults)},deepApply:function(target,config,noOverwrite){for(var propName in config){var propValue=config[propName];if(!glu.isObject(propValue)||"parentVM"===propName||"rootVM"===propName||"parentList"===propName||"meta"===propName||"ownerCt"===propName||glu.isInstantiated(propValue)){if(!noOverwrite||!target.hasOwnProperty(propName))if(glu.isArray(propValue)){for(var newArray=[],i=0;propValue.length>i;i++){var item=propValue[i];if(glu.isObject(item)){var newtarget={};glu.deepApply(newtarget,item,noOverwrite),newArray.push(newtarget)}else newArray.push(item)}target[propName]=newArray}else target[propName]=propValue}else target[propName]=target[propName]||{},glu.deepApply(target[propName],propValue,noOverwrite)}return target},deepApplyIf:function(obj,config){return glu.deepApply(obj,config,!0)},traitReg:{},regTrait:function(name,trait){this.traitReg[name]=trait},mixin:function(){for(var target=arguments[0],i=1;arguments.length>i;i++)this.mixinSingleTrait(target,arguments[i])},mixinSingleTrait:function(target,traitName){if(glu.log.info("asked to mixin trait "+traitName),!glu.isString(traitName))throw Error("You must pass in the short string name of the trait, not the trait itself");if(void 0===target.traits&&(target.traits={}),null==target.traits[traitName]){var trait=new this.traitReg[traitName];if(void 0===trait)throw Error("no such trait '"+traitName+"' exists");if(null!=trait.requiresTrait){glu.log.info("processing "+trait.requiresTrait.length+" requirements");for(var i=0;trait.requiresTrait.length>i;i++){var traitRef=trait.requiresTrait[i];this.mixin(target,traitRef)}}var stripped=glu.apply({},trait),initTrait=stripped.initTrait;delete stripped.initTrait,delete stripped.requiresTrait,this.apply(target,trait),glu.log.info(initTrait),null!=initTrait&&initTrait.call(target),target.traits[trait]=!0}},mreg:function(mtype,constructor){this.mtypeRegistry[mtype]=constructor},localizer:function(config){var nsGlobal=glu.namespace(config.ns+"."+glu.conventions.localeNs);if(void 0===nsGlobal)throw Error("Could not find locale for namespace "+config.ns);var viewSpecific=config.viewmodel?nsGlobal[config.viewmodel.viewmodelName]||nsGlobal[config.viewmodel.recType]||{}:{},key=config.key,value=viewSpecific[key]||nsGlobal[key]||glu.conventions.asLocaleKey(key);return value.indexOf("{")>-1&&(value=glu.string(value).format(config.params,config.viewmodel)),value},localize:function(key,cfg){return glu.isObject(key)?cfg=key:cfg.key=key,0==cfg.key.indexOf(glu.conventions.localizeStart)&&glu.symbol(cfg.key).endsWith(glu.conventions.localizeEnd)&&(cfg.key=cfg.key.substring(glu.conventions.localizeStart.length,cfg.key.length-glu.conventions.localizeEnd.length)),cfg.ns=cfg.ns||cfg.viewmodel.ns,cfg.params=cfg.params||{},this.localizer(cfg)},setLocalizer:function(fn){this.localizer=fn},confirm:function(title,message,fn,scope){return glu.provider.confirm(title,message,fn,scope)},message:function(title,message,fn,scope){return glu.provider.message(title,message,fn,scope)},prompt:function(title,message,fn,scope){return glu.provider.prompt(title,message,fn,scope)},regAdapter:function(name,adapter){return glu.provider.regAdapter(name,adapter)},regBindingDirective:function(name,bindingDirective){this.bindingDirectiveRegistry[name]=bindingDirective},parseBindingSyntax:function(bindingString){if(!glu.isString(bindingString))return null;if(-1==bindingString.indexOf(glu.conventions.startDelimiter)&&-1==bindingString.indexOf(glu.conventions.localizeStart))return null;if(-1==bindingString.indexOf(glu.conventions.endDelimiter)&&-1==bindingString.indexOf(glu.conventions.localizeEnd))return{valid:!1,bindExpression:bindingString,reason:"Syntax Error: Missing closing delimiter"};var results=null;if(0==bindingString.indexOf(glu.conventions.localizeStart))return{valid:!0,bindExpression:bindingString,localizationKey:bindingString.substring(glu.conventions.localizeStart.length,bindingString.length-glu.conventions.localizeEnd.length)};var boundObjectRegx=RegExp(glu.conventions.bindingSymbol+"(.*?)\\"+glu.conventions.startDelimiter),boundObjectResults=bindingString.match(boundObjectRegx);if(glu.isArray(boundObjectResults)&&boundObjectResults.length>0){var directive=boundObjectResults[boundObjectResults.length-1];directive||(directive="tocontrol");for(var k in this.bindingDirectiveRegistry)for(var symbols=this.bindingDirectiveRegistry[k].symbols,i=0;symbols.length>i;i++)if(symbols[i]==directive){results=glu.apply({valid:!0},this.bindingDirectiveRegistry[k]);var directiveRegx=RegExp("\\"+glu.conventions.startDelimiter+"(.*?)\\"+glu.conventions.endDelimiter),directiveResults=bindingString.match(directiveRegx);glu.isArray(directiveResults)&&directiveResults.length>0&&(results.bindExpression=directiveResults[directiveResults.length-1]),results.isFormula=!1;var startDelimiterLocation=bindingString.indexOf(glu.conventions.bindingSymbol),endDelimiterLocation=bindingString.indexOf(glu.conventions.endDelimiter);return(startDelimiterLocation>0||bindingString.length-glu.conventions.endDelimiter.length>endDelimiterLocation)&&(results.isFormula=!0,results.prefix=bindingString.substring(0,startDelimiterLocation),results.suffix=bindingString.substring(endDelimiterLocation+1)),results}}return results},openWindow:function(config,viewModel){return glu.provider.openWindow(config,viewModel)},viewport:function(config){return glu.provider.viewport(config)},panel:function(){return glu.provider.panel.apply(glu.provider,arguments)},equivalent:function(oldVal,newVal){if(null==oldVal&&null!=newVal||null!=oldVal&&null==newVal)return!1;if(glu.isArray(newVal)){if(oldVal==newVal)return!0;if(oldVal.length!=newVal.length)return!1;for(var i=0;oldVal.length>i;i++)if(oldVal[i]!=newVal[i])return!1;return!0}return glu.isObject(newVal)&&newVal==oldVal?!0:oldVal===newVal},setTestMode:function(){this.testMode=!0},validations:{notEmpty:function(prop){return function(){var val=this.get(prop);return null==val||""==val?"This field is required.":!0}}},widget:function(config){return glu.provider.widget(config)},_splitReference:function(fqname){var splitAt=fqname.lastIndexOf(".");if(-1===splitAt)throw Error("Reference '"+fqname+"' requires a namespace");return{ns:fqname.substring(0,splitAt),name:fqname.substring(splitAt+1)}},def:function(fqname,config,location){var capture=this._splitReference(fqname,config,location),nsObj=glu.ns(capture.ns+"."+location);nsObj[capture.name]=config},defModel:function(fqname,config){this.def(fqname,config,glu.conventions.viewmodelNs)},defView:function(fqname,viewmode,config){glu.isString(viewmode)?fqname=fqname+"_"+viewmode:config=viewmode,this.def(fqname,config,glu.conventions.viewNs)},extend:function(baseConstructor,classDef){var constructor=classDef.constructor===Object?function(){baseConstructor.apply(this,arguments)}:classDef.constructor,tempBaseConstructor=function(){};return tempBaseConstructor.prototype=baseConstructor.prototype,constructor.prototype=new tempBaseConstructor,constructor.superclass=baseConstructor.prototype,constructor.prototype.constructor=constructor,delete classDef.constructor,glu.apply(constructor.prototype,classDef),constructor},define:function(name,classDef){var baseCls=glu.walk(classDef.extend)||function(){},cls=glu.extend(baseCls,classDef),ref=glu._splitReference(name);return glu.ns(ref.ns)[ref.name]=cls,cls},updatingUI:function(){glu.provider.updatingUI()},getDataTypeOf:function(value){return glu.isString(value)?type="string":glu.isNumber(value)?type="int":Ext.isBoolean(value)?type="boolean":glu.isObject(value)?type="object":Ext.isDate(value)&&(type="date"),type},plugin:function(name){this.plugins.push(name)},plugins:[]},window.existingGlu&&(glu.provider=existingGlu.provider,glu.apply(glu,existingGlu),delete window.existingGlu),glu.ns=glu.namespace,"touch"!=Ext.getProvider().provider&&glu.panel("glupanel",{}),void 0===window.glu&&(glu={}),glu.conventions={localizeStart:"~~",localizeEnd:"~~",localeNs:"locale",bindingSymbol:"@",startDelimiter:"{",endDelimiter:"}",autoUp:"..",not:"!",windowPath:"/",parentProperty:"parentVM",specSuffix:"",viewmodelNs:"viewmodels",viewNs:"views",lookupNs:"lookups",bindProp:function(propname){return this.expression(propname)},asLocaleKey:function(propName){return this.localizeStart+propName+this.localizeEnd},expression:function(propname,options){if(!options)return this.bindingSymbol+this.startDelimiter+propname+this.endDelimiter;var str=this.bindingSymbol;return options.optional&&(str+="?"),options.onetime&&(str+="1"),str+=this.startDelimiter,options.not&&(str+=this.not),options.root&&(str+=this.windowPath),options.up&&(str+=this.autoUp),str+propname+this.endDelimiter},build:function(){var expr=glu.conventions.bindingSymbol;return{start:function(){return expr+=glu.conventions.startDelimiter,this},root:function(){return expr+=glu.conventions.windowPath,this},allUp:function(){return expr+=glu.conventions.autoUp,this},up:function(){return expr+=glu.conventions.parentProperty,this},prop:function(prop){return expr+="."+prop,this},lookupNs:function(){return expr+="."+glu.conventions.lookupNs,this},literal:function(lit){return expr+=lit,this},dot:function(){return expr+=".",this},end:function(){return expr+glu.conventions.endDelimiter}}}},glu.regBindingDirective("onetime",{symbols:["onetime","1"],onetime:!0,oneway:!0,toModel:!1,toControl:!0}),glu.regBindingDirective("twoway",{symbols:["twoway","<>"],onetime:!1,oneway:!1,toModel:!0,toControl:!0}),glu.regBindingDirective("tocontrol",{symbols:["tocontrol",">"],onetime:!1,oneway:!0,toModel:!1,toControl:!0}),glu.regBindingDirective("optional",{symbols:["optional","?"],optional:!0,toModel:!0,toControl:!0}),glu.Viewmodel=glu.extend(Object,{constructor:function(config){glu.log.debug("BEGIN viewmodel construction"),glu.Viewmodel.superclass.constructor.call(this),this._setRawMessage=glu.symbol("{vmName}.{name}: {oldValue} --> {newValue}"),glu.deepApply(this,config),this._private=this._private||{},this._private.setters={},this._private.meta={},this._private.reactors=[],this._private.data=this._private.data||{},new glu.GraphObservable({vm:this}),this._private.viewmodelName=config.viewmodelName,this._private.children=[],this._private.isInitialized=!1,this.rootVM=this.parentVM?this.parentVM.rootVM:this,delete config.viewmodelName,this.init=function(){return this._private&&this._private.isInitialized?(glu.log.warn("attempted to initialize an already initialized view model. Init() is a lifecycle function so please put any code you need to call multiple times elsewhere."),void 0):(this._private.isInitialized=!0,config.init&&config.init.apply(this,arguments),this.initChildren(),config.initComplete&&config.initComplete.apply(this,arguments),void 0)},this.activate=config.activate||function(){},this.deactivate=config.deactivate||function(){},this.close=config.close||this.doClose,config.onCreate&&config.onCreate.call(this),this._walkConfig(),this.firingInitialReactors=!0;for(var i=0;this._private.reactors.length>i;i++){var reactor=this._private.reactors[i];reactor.init&&reactor.init()}if(delete this.firingInitialReactors,this._private.isInstantiated=!0,glu.testMode){this.message=jasmine.createSpy("message"),this.confirm=jasmine.createSpy("confirm"),this.prompt=jasmine.createSpy("prompt");var me=this;this.confirm.respond=function(btn,txt){me._fakeRespond("confirm",btn,txt)},this.message.respond=function(btn,txt){me._fakeRespond("message",btn,txt)},this.prompt.respond=function(btn,txt){me._fakeRespond("prompt",btn,txt)}}glu.log.debug("END viewmodel construction")},_fakeRespond:function(action,btn,txt){var next=this[action].mostRecentCall;if(void 0===next||void 0===next.args||0===next.args.length)throw action+"was never called";var fn=Ext.isString(next.args[0])?next.args[2]:next.args[0].fn;fn.call(this,btn,txt)},doClose:function(){this.parentList&&this.parentList.remove(this),this.fireEvent("closed",this)},get:function(propName){return this.getRaw(propName)},set:function(propName,value){var setter=this._private.setters[propName];if(void 0===setter)throw Error("Cannot set: This view model has no property named "+propName);setter.call(this,value)},toString:function(){var label=this.name||this.id||"?";return"["+this.viewmodelName+" "+label+"]"},setRaw:function(propName,value,asSideEffect){var subModel=glu.isObject(value)&&value._ob;this[propName]&&this[propName]._ob&&this._ob.detach(propName);var oldValue=this.get(propName);glu.equivalent(oldValue,value)||(this.firingInitialReactors||glu.log.info(this._setRawMessage.format({vmName:""+this,name:propName,newValue:value,oldValue:oldValue})),this._private.data[propName]=value,glu.isFunction(this[propName])||(this[propName]=value),this.fireEvent(propName+"Changed",value,oldValue,{modelPropName:propName}),this.fireEvent("propertychanged",propName,value,oldValue),this[propName]&&this[propName]._ob&&this._ob.attach(propName),1!=asSideEffect&&this.fireEvent("changed",propName,value,oldValue))},getRaw:function(propName){return this._private.data.hasOwnProperty(propName)?this._private.data[propName]:this[propName]},getPropertyInfo:function(propName){var value=this.get(propName),type=glu.getDataTypeOf(value);return{name:propName,type:type}},on:function(eventName,handler,scope){scope=scope||this,this._ob.on(eventName,handler,scope)},fireEvent:function(){glu.log.debug('Viewmodel "'+this.referenceName+'" is firing event "'+arguments[0]+'""'),this._ob.fireEvent.apply(this._ob,arguments)},_walkConfig:function(){var propNames=[];for(var propName in this)propNames.push(propName);for(var i=0;propNames.length>i;i++){var propName=propNames[i];this.hasOwnProperty(propName)&&this._processConfigProperty(propName)}},_processConfigProperty:function(propName,propValue){if("_private"!==propName&&"requiresTrait"!==propName&&"set"!==propName&&"get"!==propName&&"referenceName"!==propName&&"viewmodelName"!==propName&&"ns"!==propName&&"mtype"!==propName&&"parentList"!==propName&&"rootVM"!==propName&&propName!==glu.conventions.parentProperty){if(propValue=propValue||this[propName],glu.isFunction(propValue)&&"on"==propName.substring(0,2)&&propName.substring(2,3).toUpperCase()==propName.substring(2,3)){var action=propValue;propValue={on:propName.substring(2),action:action}}if(glu.isFunction(propValue)&&propName.match(/\$$/)&&(propName=propName.substring(0,propName.length-1),propValue={on:"$",formula:propValue}),!glu.isFunction(propValue)){if(glu.isObject(propValue)&&glu.Reactor.is(propValue)&&(propValue.formula&&propName.match(/IsValid$/)&&this._processValidator(propName,propValue),propValue.formula?glu.log.debug("Building formula "+propName):glu.log.debug("Building reaction "+propName),this._private.reactors.push(glu.Reactor.build(propName,propValue,this))),glu.isObject(propValue)&&propValue.hasOwnProperty("mtype")){propValue.referenceName=propName,this._private.children.push(propName);var model=glu.isInstantiated(propValue)?propValue:this.model(propValue);return propValue=model,this[propName]=model,this._ob.attach(propName,model,"parentVM"),this.makePropertyAccessors(propName,propValue,!0),void 0}glu.log.debug('Adding setter/getter for "'+propName+'"'),this.makePropertyAccessors(propName,propValue)}}},_processValidator:function(propName,propValue){function updateGlobalValidity(newVal){var valid=newVal,actual=valid;glu.isString(valid)&&(valid=!1);var oldValid=me._private.validMap.hasOwnProperty(propName)?me._private.validMap[propName]:!0;return oldValid&&!valid&&me._private.invalidCount++,!oldValid&&valid&&me._private.invalidCount--,me._private.validMap[propName]=valid,me.setRaw("isValid",0==me._private.invalidCount),actual}var formula=propValue.formula,me=this;this.on(propName+"Changed",function(newVal){updateGlobalValidity(newVal)},this),this._private.hasValidators=!0,this._private.validMap=this._private.validMap||{},this._private.invalidCount=0,this.isValid=!0,this.makePropertyAccessors("isValid",!0)},makePropertyAccessors:function(propName,initialValue,isChildModel){this._private.data[propName]=initialValue;var me=this,setter=this["set"+glu.string(propName).toPascalCase()]||function(value){me.setRaw(propName,value,isChildModel)};this._private.setters[propName]=setter,this._private.meta[propName]={setter:setter,isChildModel:isChildModel},this[propName]=initialValue},registerControlBinding:function(modelPropName,control){glu.testMode&&(this._private.controlBindings=this._private.controlBindings||{},this._private.controlBindings[modelPropName]||(this._private.controlBindings[modelPropName]=[]),this._private.controlBindings[modelPropName].push(control))},model:function(mtype,config){glu.isObject(mtype)&&(config=mtype,mtype=null),null==config&&(config={}),config.mtype=config.mtype||mtype||"viewmodel",config.ns=this.ns,config.parentVM=this,config.rootVM=this.rootVM;var vm=glu.model(config);return this._private.isInitialized&&vm._private&&vm.init&&!vm._private.isInitialized&&vm.init(),vm},localize:function(key,params){return glu.localize({viewmodel:this,key:key,params:params})},confirm:function(title,message,fn,scope){return glu.isObject(title)&&(title.scope=title.scope||this),scope=scope||this,glu.confirm(title,message,fn,scope)},message:function(title,message,fn,scope){return glu.isObject(title)&&(title.scope=title.scope||this),scope=scope||this,glu.message(title,message,fn,scope)},prompt:function(title,message,fn,scope){return glu.isObject(title)&&(title.scope=title.scope||this),scope=scope||this,glu.prompt(title,message,fn,scope)},open:function(childVM,viewMode){return glu.isInstantiated(childVM)||(childVM.ns=childVM.ns||this.ns,childVM.parentVM=childVM.parentVM||this,childVM=this.model(childVM)),glu.testMode||glu.openWindow(childVM,viewMode),childVM},ajax:function(config){glu.apply(config,{scope:this}),Ext.Ajax.request(config)},initChildren:function(){for(var i=0;this._private.children.length>i;i++){var child=this[this._private.children[i]];glu.isFunction(child.init)&&(child._private.isInitialized||child.init())}},commitBulkUpdate:function(){this.fireEvent("bulkupdatecommitted",this)},unParent:function(){this._ob.detach("parentVM"),delete this.parentVM},attach:function(){this._ob.attachAll()},detach:function(){this._ob.detachAll()}}),glu.mreg("viewmodel",glu.Viewmodel),glu.List=glu.extend(Object,{constructor:function(config){config=config||{},this.autoParent=!1,this.autoDetach=!1,glu.deepApply(this,config),this.length=0,this._private=this._private||{},this._private.objs=[],new glu.GraphObservable({vm:this}),config.items=config.items||config.data||[];for(var i=0;config.items.length>i;i++){var item=config.items[i];this.add(item,!0)}delete this.items},add:function(obj,silent,isTransfer){this.insert(this.length,obj,isTransfer)},insert:function(index,obj,isTransfer){if(this.autoParent&&obj.parentVM&&obj.parentVM!==this.parentVM)throw Error("View model already has a parent and needs to be removed from there first");glu.isObject(obj)&&obj.mtype&&(void 0===obj._private&&(obj.ns=obj.ns||this.ns,this.autoParent&&(obj.parentVM=this.parentVM,obj.parentList=this),obj=glu.model(obj)),this.autoParent&&(obj.parentList=this,obj._ob.attach("parentVM")),obj._ob.attachAll()),this._private.objs.splice(index,0,obj),this.length++,this.fireEvent("lengthchanged",this.length,this.length-1),this.fireEvent("added",obj,index,isTransfer)},remove:function(Obj,isTransfer){return this.removeAt(this.indexOf(Obj),isTransfer)},removeAt:function(index,isTransfer){var obj=this.getAt(index);if(null!=obj)return this._private.objs.splice(index,1),this.length--,obj._ob&&(this.autoParent&&(obj._ob.detach("parentVM"),obj._ob.detach("rootVM")),this.autoDetach&&obj._ob.detachAll()),this.fireEvent("removed",obj,index,isTransfer),this.activeIndex>index&&this.setActiveIndex(this.getActiveIndex()-1),this.fireEvent("lengthchanged",this.length,this.length+1),obj},removeAll:function(){for(this.fireEvent("removedall",this);this.length>0;)this.removeAt(0)},transferFrom:function(otherList,item,newIndex){null==newIndex&&(newIndex=this.length),otherList.remove(item,!0),this.insert(newIndex,item,!0),this.fireEvent("transferred",otherList,item,newIndex)},indexOf:function(obj){if(this._private.objs.indexOf)return this._private.objs.indexOf(obj);for(var i=0;this._private.objs.length>i;i++)if(obj===this._private.objs[i])return i;return-1},contains:function(Obj){return this.indexOf(Obj)>-1},getAt:function(index){return this._private.objs[index]},length:0,getCount:function(){return this._private.objs.length},foreach:function(operation,scope){for(var i=0;this.length>i;i++){var item=this.getAt(i),myScope=scope||item;operation.call(myScope,item,i)}},find:function(fn,scope){for(var i=0;this.length>i;i++){var item=this.getAt(i),myScope=scope||item;if(fn.call(myScope,item))return item}},on:function(eventName,handler,scope){scope=scope||this,this._ob.on(eventName,handler,scope)},toArray:function(){return this._private.objs.slice()},fireEvent:function(){glu.log.debug('List "'+this.referenceName+'" is firing event "'+arguments[0]+'""'),this._ob.fireEvent.apply(this._ob,arguments)}}),glu.mreg("list",glu.List),glu.mreg("keytracking",{initMixin:function(){this.keyMap={},this.idProperty=this.idProperty||"id";for(var i=0;this._private.objs.length>i;i++)this.addKey(this._private.objs[i]);this.on("added",this.addKey),this.on("removed",this.removeKey)},addKey:function(item,idx){var key=item[this.idProperty];if(this.keyMap[key])throw Error('Duplicate key "'+key+'" not allowed in a key-tracked list');void 0!==key&&(this.keyMap[key]=item)},removeKey:function(item){var key=item[this.idProperty];void 0!==key&&delete this.keyMap[key]},containsKey:function(key){return void 0!==this.keyMap[key]},getById:function(key){return this.keyMap[key]},getAtKey:function(key){return this.keyMap[key]},indexOfKey:function(key){return this.indexOf(this.getAtKey(key))},removeAtKey:function(key){var item=this.keyMap[key];null!=item&&this.remove(item)}}),glu.List.prototype.forEach=glu.List.prototype.foreach,glu.List.prototype.where=function(filter){for(var f=[],i=0;this.length>i;i++){var item=this.getAt(i);filter.call(this.parentVM,item)&&f.push(item)}return f},glu.List.prototype.count=function(filter){return this.where(filter).length},glu.List.prototype.any=function(filter){return this.where(filter).length>0},glu.ViewmodelActivator=glu.extend(glu.List,{constructor:function(config){glu.ViewmodelActivator.superclass.constructor.call(this,config),this.activeIndex=this.activeIndex||0,this.activeItem=this.getActiveItem(),this.focusProperty=config.focusProperty||glu.symbol(config.referenceName).until("List")+"WithFocus",this.focusPropertyType=config.focusPropertyType||"viewmodel";var me=this;this.parentVM.on(this.focusProperty+"Changed",function(value){glu.isNumber(value)?me.setActiveIndex(value):me.setActiveItem(value)})},init:function(){this.foreach(function(submodel){submodel.init()},this)},getActiveItem:function(){return this.getAt(this.getActiveIndex())},removeAt:function(toRemove){toRemove===this.activeIndex&&toRemove===this.length-1&&this.setActiveIndex(toRemove-1);var obj=glu.ViewmodelActivator.superclass.removeAt.call(this,toRemove);return toRemove===this.activeIndex&&this.setActiveIndex(this.getActiveIndex()),null==this.getActiveItem(),obj},getActiveIndex:function(){return this.activeIndex},setActiveIndex:function(idx){this.activeItem&&this.activeItem.exit&&this.activeItem.exit(),this.activeIndex=idx,this.activeItem=this.getActiveItem(),this.parentVM.set(this.focusProperty,"viewmodel"===this.focusPropertyType?this.activeItem:this.activeIndex),null!=this.activeItem&&this.activeItem.enter&&this.activeItem.enter()},setActiveItem:function(item){var idx=this.indexOf(item);if(-1==idx&&null!=item)throw"You are attempting to pass in a view model that is not contained by the activator.";this.setActiveIndex(idx)}}),glu.mreg("viewmodelactivator",glu.ViewmodelActivator),glu.mreg("activatorlist",glu.ViewmodelActivator),glu.DataModel=glu.extend(glu.Viewmodel,{constructor:function(config){if(glu.log.debug("BEGIN datamodel construction"),this._private=this._private||{},config.recType=config.recType||config.model||config.modelType,config.recType)this._private.model=glu.walk(config.ns+".models."+config.recType);else{if(glu.isArray(config.fields))for(var i=0,len=config.fields.length;len>i;i++)glu.isString(config.fields[i])&&(config.fields[i]={name:config.fields[i],type:"string"});this._private.model={fields:config.fields}}if(this._private.recType=config.recType,delete config.recType,this._private.url=config.url||"/"+config.recType+"/read",this._private.saveurl=config.saveUrl||"/"+config.recType+"/save",this._private.dirtyCount=0,delete config.url,delete config.saveurl,glu.isFunction(config.params)&&(this._private.paramGenerator=config.params,delete config.params),Ext.getVersion().major>3||"touch"==Ext.getProvider().provider){var modelId=Ext.id();Ext.define(modelId,{extend:"Ext.data.Model",fields:this._private.model.fields}),this.reader=new Ext.data.reader.Json({model:modelId})}else this.reader=new Ext.data.JsonReader({},this._private.model.fields);var idProp="id";void 0===config[idProp]&&(config[idProp]="");var initialRecord=this.reader.readRecords([config]).records[0];this._private.record=initialRecord,glu.apply(this,initialRecord.data),this._private.data=this._private.data||{},glu.apply(this._private.data,initialRecord.data),this._private.record.fields.each(function(rec){var name=rec.name+"IsDirty";config[name]={on:[rec.name+"Changed"],formula:function(){return this.isModified(rec.name)}}},this),config.isDirty=!1,glu.DataModel.superclass.constructor.apply(this,arguments),glu.log.debug("END datamodel construction")},setRaw:function(fieldName,value,suppressDirtyEvent){var rec=this._private.record;if(rec.fields.containsKey(fieldName)){var wasDirty=this.isModified(fieldName);rec.set(fieldName,value),rec.modified&&value==rec.modified[fieldName]&&delete rec.modified[fieldName];var isDirtyNow=this.isModified(fieldName);!wasDirty&&isDirtyNow&&this._private.dirtyCount++,wasDirty&&!isDirtyNow&&this._private.dirtyCount--}glu.DataModel.superclass.setRaw.apply(this,arguments),rec.fields.containsKey(fieldName)&&this.set("isDirty",this._private.dirtyCount>0)},isModified:function(propName){var rec=this._private.record;return rec.hasOwnProperty("modified")&&rec.modified.hasOwnProperty(propName)},asObject:function(){return glu.apply({},this._private.record.data)},load:function(id){var url=this.url;if(this.appendId&&(url=url+(glu.string(url).endsWith("/")?"":"/")+id),this.paramGenerator){var config={params:{}};config.params=glu.apply(config.params,this._serialize(Ext.createDelegate(this._private.paramGenerator,this)()))}var jsonData={id:id};config.params&&(jsonData.params=config.params),Ext.Ajax.request({url:url,method:"POST",jsonData:jsonData,scope:this,success:function(response,opts){var responseObj=Ext.decode(response.responseText);if(responseObj.success){var data=responseObj[this.root];this.loadData(data)}else Ext.Msg.alert("Status",responseObj.message)}})},save:function(){var url=this.saveurl;if(this.appendId&&(url=url+(glu.string(url).endsWith("/")?"":"/")+id),this._private.paramGenerator){var config={params:{}};config.params=glu.apply(config.params,this._serialize(Ext.createDelegate(this._private.paramGenerator,this)()))}var jsonData={model:this._private.model.name,data:this.getChanges(),id:this.getId()};config.params&&(jsonData.params=config.params),Ext.Ajax.request({url:url,method:"POST",jsonData:jsonData,scope:this,success:function(response,opts){var responseObj=Ext.decode(response.responseText);if(responseObj.success){var data=responseObj[this.root];data?(this._private.record=new this._private.record(data,data[this._private.model.idProperty]),this.loadData(data)):this._private.record.commit(!0)}else Ext.Msg.alert("Status",responseObj.message)},failure:function(response,opts){Ext.Msg.alert("Status","Unable to contact the server.  Please try again later.")}})},getFieldModel:function(){return this._private.model},_serialize:function(data){if(data)for(var k in data)glu.isArray(data[k])&&(data[k]=glu.json.stringify(data[k]));return data},loadData:function(rawData){var idProp="id";void 0===rawData[idProp]&&(rawData[idProp]="");var data=this.reader.readRecords([rawData]).records[0].data;for(var k in data)this.setRaw(k,data[k]);this.commit()},getId:function(){return this._private.record.get(this._private.model.idProperty)},getFieldConfig:function(fieldName){for(var i=0;this._private.model.fields.length>i;i++)if(this._private.model.fields[i].name==fieldName)return this._private.model.fields[i];
return null},commit:function(){this._private.record.commit(!0);for(var i=0;this._private.model.fields.length>i;i++){var field=this._private.model.fields[i].name||this._private.model.fields[i];this.set(field+"IsDirty",!1)}this._private.dirtyCount=0,this.set("isDirty",!1)},getOriginalValue:function(fieldName){return this.isModified(fieldName)?this._private.record.modified[fieldName]:this.get(fieldName)},getChanges:function(){return this._private.record.getChanges()},revert:function(){this._private.record.reject(!0),this.loadData(this._private.record.data),this.commit()}}),glu.mreg("datamodel",glu.DataModel),glu.GraphObservable=Ext.extend(Ext.emptyFn,{constructor:function(config){glu.apply(this,config),this.node=this.node||this.vm||this,this.node._ob=this,glu.apply(this,{edges:{},events:{}})},on:function(path,fn,scope){var tokens=path.split(".");scope=scope||this.node,this.propagateRequest({id:Ext.id(),remainder:tokens,origin:{fn:fn,scope:scope}})},fireEvent:function(){var name=arguments[0].toLowerCase(),evt=this.events[name];if(evt){var args=Array.prototype.slice.call(arguments);args.shift();var cullList=[];for(var key in evt.listeners){var listener=evt.listeners[key],myVeto=listener.origin.fn.apply(listener.origin.scope,args);if(myVeto===!0)return!1;"discard"===myVeto&&cullList.push(key)}for(var key in cullList)delete evt.listeners[key];return!0}},propagateRequest:function(request){if(1==request.remainder.length){var evtName=request.remainder[0].toLowerCase();this.events[evtName]=this.events[evtName]||{listenersCount:0,listeners:{}};var evt=this.events[evtName];return evt.listeners[request.id]||(evt.listeners[request.id]={id:request.id,origin:request.origin},evt.listenersCount++),void 0}var myRequest={id:request.id,remainder:request.remainder.slice(1),origin:request.origin},nextEdge=request.remainder[0];this.edges[nextEdge]=this.edges[nextEdge]||{},this.edges[nextEdge][myRequest.id]=myRequest;var edgeVM=this.node[nextEdge];edgeVM&&edgeVM._ob&&edgeVM._ob.propagateRequest(myRequest)},propagateRemoval:function(request){if(1==request.remainder.length){var evtName=request.remainder[0].toLowerCase(),evt=this.events[evtName];if(!evt||!evt.listeners[request.id])return;return delete evt.listeners[request.id],evt.listenersCount--,void 0}var myRequest={id:request.id,remainder:request.remainder.slice(1)},nextEdge=request.remainder[0],edge=this.edges[nextEdge];if(edge){delete edge[myRequest.id];var edgeVM=this.node[nextEdge];edgeVM&&edgeVM._ob&&edgeVM._ob.propagateRemoval(myRequest)}},attach:function(forwardRefName,other,backRefName){if(other=other||this.node[forwardRefName],this.node[forwardRefName]=other,this.attachOneWay(forwardRefName),backRefName){other[backRefName]=this.node;var other=this.node[forwardRefName];if(!other._ob)return;other._ob.attachOneWay(backRefName)}},attachAll:function(){for(var key in this.edges)this.attach(key)},detach:function(forwardRefName,backRefName){var other=this.node[forwardRefName];if(this.detachOneWay(forwardRefName),backRefName){if(other[backRefName]=null,!other._ob)return;other._ob.detachOneWay(backRefName)}},detachAll:function(){for(var key in this.edges)this.detach(key)},attachOneWay:function(refName){var edges=this.edges[refName];if(edges){var other=this.node[refName];if(!other||!other._ob)return;for(var requestId in edges){var request=edges[requestId];other._ob.propagateRequest(request)}}},detachOneWay:function(refName){var edges=this.edges[refName];if(edges){var other=this.node[refName];if(!other||!other._ob)return;for(var requestId in edges){var request=edges[requestId];other._ob.propagateRemoval(request)}}}}),glu.log=function(){glu.logLevel=glu.logLevel||"info",Ext.isIE&&(glu.logLevel="off");var levels={off:0,error:10,warn:20,info:30,debug:40},empty=function(){},level=levels[glu.logLevel]||0;return{info:level>=30?function(str){console.log("INFO:  "+str)}:empty,warn:level>=20?function(str){console.log("WARN:  "+str)}:empty,error:level>=10?function(str){console.log("ERROR:  "+str)}:empty,debug:level>=40?function(str){console.log("DEBUG:  "+str)}:empty,indents:0,indent:"",indentMore:function(){this.indents++,this.indent=Array(this.indents).join("   ")},indentLess:function(){this.indents--,0>this.indents&&(this.indents=0),this.indent=Array(this.indents).join("   ")}}}(),glu.Model=glu.extend(Object,{constructor:function(config){glu.Model.superclass.constructor.call(this),glu.apply(this,config),this._private=this._private||{},this._private.data={}},get:function(propName){return this[propName]},set:function(propName,value){this.setRaw(propName,value)},setRaw:function(propName,value){var oldValue=this.get(propName);oldValue!==value&&(this._private.data[propName]=value,this[propName]=value,this.fireEvent(propName+"Changed",value,oldValue,{modelPropName:propName}),this.fireEvent("changed",value,oldValue,{modelPropName:propName}))}}),glu.mreg("model",glu.Model),glu.model=function(mtype,config){function upcastIfNeeded(cfg){return"viewmodel"===cfg.mtype&&(cfg.fields||cfg.recType||cfg.modelType||cfg.model)?"datamodel":cfg.mtype}if(glu.isObject(mtype)&&(config=mtype,mtype=null),null==config&&(config={}),config.mtype=config.mtype||mtype||"viewmodel",config.mtype&&config.mtype.indexOf(".")>-1){var split=glu._splitReference(config.mtype);config.ns=split.ns,config.mtype=split.name}config.mtype=config.mtype||"viewmodel",config.mtype=upcastIfNeeded(config);var mtype=config.mtype,ns=config.ns,viewModelRegistry=ns?glu.walk(ns+"."+glu.conventions.viewmodelNs):{};if(glu.mtypeRegistry.hasOwnProperty(mtype)){for(var mixins=config.mixins||[],applyMixins=[],i=0;mixins.length>i;i++){var mixinConfig=mixins[i],mixinName;mixinName=glu.isObject(mixinConfig)?mixinConfig.type:mixinConfig;var mixin=viewModelRegistry[mixinName]||glu.mtypeRegistry[mixinName];if(void 0===mixin){var factory=viewModelRegistry[mixinName+"Factory"];if(void 0===factory)throw"Unable to find mixin: "+mixinName;mixin=factory(config)}glu.isObject(mixinConfig)&&glu.apply(mixin,mixinConfig),glu.deepApply(config,mixin,!0),applyMixins.push(mixin),glu.mtypeRegistry[mixinName]&&delete config.mixins}var temp=new glu.mtypeRegistry[mtype](config);for(i=0;applyMixins.length>i;i++)applyMixins[i].initMixin&&applyMixins[i].initMixin.apply(temp);return temp}if(glu.log.debug(mtype+" is not a built-in type, checking for a view model under the namespace. "),!ns)throw"Unable to create model: attempting to create a specified view model without a namespace (ns).";var className=mtype,vmSpecBase=viewModelRegistry[className];if(void 0===vmSpecBase){var factory=viewModelRegistry[className+"Factory"];if(void 0===factory)throw"Unable to create model: Could not find specification for view model "+className;vmSpecBase=factory(config)}var vmSpec={};return glu.deepApply(vmSpec,vmSpecBase),glu.deepApply(vmSpec,config),vmSpec.mtype=vmSpecBase.mtype||"viewmodel",vmSpec.mtype=upcastIfNeeded(vmSpec),vmSpec.ns=ns,vmSpec.viewmodelName=className,vmSpec.referenceName=vmSpec.referenceName||"root",new glu.model(vmSpec)},glu.Observable=glu.extend(Object,{constructor:function(){this._ob=this._ob||{},this._ob.events={}},fireEvent:function(){var name=arguments[0].toLowerCase(),args=Array.prototype.slice.call(arguments);args.shift(),this._ob.events.hasOwnProperty(name)||(this._ob.events[name]={listeners:[]});for(var evt=this._ob.events[name],cullList=[],i=0;evt.listeners.length>i;i++){var listener=evt.listeners[i],myVeto=listener.fn.apply(listener.scope,args);if(myVeto===!0)return!1;"discard"===myVeto&&cullList.unshift(i)}for(var i=0;cullList.length>i;i++)evt.listeners.splice(cullList[i],1);return!0},on:function(name,callback,scope){name=name.toLowerCase(),this._ob.events.hasOwnProperty(name)||(this._ob.events[name]={listeners:[]});var evt=this._ob.events[name];evt.listeners.push({fn:callback,scope:scope||glu})}}),glu.observer=new glu.Observable,glu.on=function(){this.observer.on.apply(this.observer,arguments)},glu.fireEvent=function(){this.observer.fireEvent.apply(this.observer,arguments)},glu.clearPlugins=function(){glu.events={}},glu.Reactor={is:function(obj){return obj.hasOwnProperty("on")&&(obj.hasOwnProperty("action")||obj.hasOwnProperty("formula"))},build:function(propName,reactor,vmOfReactor,scope){function find(regex){for(;matches=regex.exec(code);){var prop=matches[1];if("get"!==prop&&"localize"!==prop)for(var tokens=prop.split("."),lastProp="",i=0;tokens.length>i;i++)toWatch[lastProp+tokens[i]+"Changed"]=!0,lastProp=lastProp+tokens[i]+"."}}scope=scope||vmOfReactor;var isFormula=reactor.hasOwnProperty("formula"),formula=reactor.formula,evts=reactor.on||[];if("$"===evts){var code=""+formula,thisMatchesRe=/this\.([\.\w]*)/g,getMatchesRe=/this\.get\s*\(\s*[\'\"]([\w\.]*)/g,toWatch={},matches;find(thisMatchesRe),find(getMatchesRe),evts=[],reactor.on=evts;for(var evt in toWatch)evts.push(evt)}glu.isString(evts)&&(evts=[evts]),isFormula&&(vmOfReactor.makePropertyAccessors&&vmOfReactor.makePropertyAccessors(propName),reactor.init=function(){vmOfReactor.setRaw(propName,formula.apply(scope),!0)});for(var action=isFormula?function(){var value=formula.apply(scope);vmOfReactor.setRaw(propName,value,!0)}:reactor.action,i=0;evts.length>i;i++){var eventName=evts[i],fullEventName=eventName;vmOfReactor.on&&vmOfReactor.on(fullEventName,action,vmOfReactor)}return reactor}},(Ext.getVersion().major>3||"touch"==Ext.getProvider().provider)&&(Ext.define("glu.rowViewmodel",{extend:"Ext.data.Model",initFormulas:function(){for(var formulaName in this.formulas){var fn=this.formulas[formulaName];glu.Reactor.build(formulaName,{on:"$",formula:fn},this,this.data)}for(var formulaName in this.formulas){var fn=this.formulas[formulaName];this.data[formulaName]=fn.apply(this.data)}},setRaw:function(formulaName,value){(this.formulasToUpdate[formulaName]&&this.formulasToUpdate[formulaName]!=value||this.get(formulaName)!=value)&&(this.formulasToUpdate[formulaName]=value,this.fireEvent(formulaName+"Changed",value,this.formulasToUpdate[formulaName]||this.get(formulaName)))},afterEdit:function(modifiedFieldNames){if(!this.settingFormulas){var name=modifiedFieldNames[0];this.formulasToUpdate={},this.fireEvent(name+"Changed",this.data[name]);for(var fName in this.formulasToUpdate)this.data[fName]=this.formulasToUpdate[fName],modifiedFieldNames.push(this.formulasToUpdate[fName]);this.settingFormulas=!1,this.callParent(modifiedFieldNames)}}}),glu.defRowModel=function(name,config){if(config.formulas)for(var formulaName in config.formulas)config.fields.push({name:formulaName});config.extend="glu.rowViewmodel",Ext.define(name,config)},Ext.define("glu.Reader",{extend:"Ext.data.reader.Json",alias:"reader.glujson",extractData:function(){var records=this.callParent(arguments);if(this.model.prototype.formulas)for(var i=0;records.length>i;i++){var rec=records[i];rec.initFormulas()}return records}})),Ext.getVersion().major>3||"touch"==Ext.getProvider().provider?Ext.define("glu.Store",{extend:"Ext.data.Store",constructor:function(config){var modelDefName=config.model;config.model&&-1==config.model.indexOf(".")&&(config.model=config.ns+".models.extjs."+config.model);var found=glu.walk(config.model);found||("touch"==Ext.getProvider().provider?Ext.define(config.model,{extend:"Ext.data.Model",config:{fields:glu.walk(config.ns+".models."+modelDefName).fields}}):Ext.define(config.model,{extend:"Ext.data.Model",fields:glu.walk(config.ns+".models."+modelDefName).fields})),this.callParent([config])}}):glu.Store=glu.extend(Ext.data.JsonStore,{remoteSort:!0,_lastSortField:null,_lastSortOrder:"ASC",constructor:function(config){if(Ext.applyIf(config,{totalProperty:"totalCount",root:"result"}),config.hasOwnProperty("recType")){var model=glu.walk(config.ns+".models."+config.recType);config.fields=model.fields,config.idProperty=config.idProperty||model.idProperty}Ext.isFunction(config.params)&&(this.paramGenerator=config.params,delete config.params),config.proxy=config.proxy||new Ext.data.HttpProxy({method:"POST",prettyUrls:!1,url:config.url}),config.proxy.url=config.proxy.url||config.url,delete config.url,this.deferredLoader=new Ext.util.DelayedTask,(Ext.getVersion().major>3||"touch"==Ext.getProvider().provider)&&(config.reader={type:"json",root:config.root,totalProperty:config.totalProperty}),glu.Store.superclass.constructor.call(this,config)},loadActual:function(loadConfig){this.paramGenerator&&(loadConfig={params:{}},loadConfig.params=Ext.apply(loadConfig.params,this._serialize(Ext.createDelegate(this.paramGenerator,this.parentVM)()))),glu.Store.superclass.load.call(this,loadConfig)},load:function(loadConfig){return glu.testMode===!0?(this.loadActual(loadConfig),void 0):(this.deferredLoader.delay(10,this.loadActual,this,[loadConfig]),!0)},loadData:function(config,append){(Ext.getVersion().major>3||"touch"==Ext.getProvider().provider)&&!Ext.isArray(config)?(glu.Store.superclass.loadData.call(this,config[this.root],append),this.totalCount=config[this.totalProperty]):glu.Store.superclass.loadData.call(this,config,append)},_serialize:function(data){if(data)for(var k in data)glu.isArray(data[k])&&(data[k]=glu.json.stringify(data[k]));return data}}),glu.mreg("store",Ext.data.Store),glu.mreg("glustore",glu.Store),glu.mreg("arraystore",Ext.data.ArrayStore),glu.mreg("jsonstore",Ext.data.JsonStore),glu.mreg("treestore",Ext.data.TreeStore),glu.mreg("listtreestoreadapter",{initMixin:function(){var attachTo=this.attachTo;this.parentVM[attachTo]&&(this.on("update",function(store,record,operation,modifiedFieldNames,eOpts){for(var index=Ext.Array.indexOf(store.getRootNode().childNodes,record),viewmodel=this[attachTo].getAt(index),i=0,len=modifiedFieldNames.length;len>i;i++)void 0!==viewmodel[modifiedFieldNames[i]]&&viewmodel.set(modifiedFieldNames[i],record.get(modifiedFieldNames[i]))},this.parentVM),this.parentVM[attachTo].on&&(this.parentVM[attachTo].on("added",function(obj,index){this.getRootNode().insertChild(index,obj)},this),this.parentVM[attachTo].on("removed",function(obj,index){this.getRootNode().removeChild(this.getRootNode().getChildAt(index))},this),this.parentVM[attachTo].on("edited",function(obj,index){this.getRootNode().getChildAt(index).set(obj.asObject())},this),this.parentVM[attachTo].on("appendchild",function(obj,parentIndex){var node=this.getRootNode().getChildAt(parentIndex);node.appendChild(obj),node.isExpanded()||node.expand()},this),this.parentVM[attachTo].on("insertchild",function(obj,parentIndex,childIndex){var node=this.getRootNode().getChildAt(parentIndex);node.insertChild(childIndex,obj),node.isExpanded()||node.expand()},this),this.parentVM[attachTo].on("removechild",function(parentIndex,child){this.getRootNode().getChildAt(parentIndex).removeChild(child)},this),this.parentVM[attachTo].on("editedchild",function(parentIndex,child,newChild){this.getRootNode().getChildAt(parentIndex).replaceChild(newChild,child)},this)))}}),glu.mreg("liststoreadapter",{initMixin:function(){var attachTo=this.attachTo;this.parentVM[attachTo]&&(this.on("update",function(store,record,operation,modifiedFieldNames,eOpts){for(var index=store.indexOf(record),viewmodel=this[attachTo].getAt(index),i=0,len=modifiedFieldNames.length;len>i;i++)void 0!==viewmodel[modifiedFieldNames[i]]&&viewmodel.set(modifiedFieldNames[i],record.get(modifiedFieldNames[i]))},this.parentVM),this.parentVM[attachTo].on&&(this.parentVM[attachTo].on("added",function(obj,index){this.insert(index,obj)},this),this.parentVM[attachTo].on("edited",function(obj,index){for(var editObj={},i=0;this.model.getFields().length>i;i++){var fieldName=this.model.getFields()[i].name;editObj[fieldName]=obj[fieldName]}this.getAt(index).set(editObj)},this),this.parentVM[attachTo].on("removed",function(obj,index){this.removeAt(index)},this)))}}),glu=window.glu||{},glu.Symbol=function(str){this.str=str},glu.symbol=function(str){return new glu.Symbol(str)},glu.string=glu.symbol,glu.apply(glu.Symbol.prototype,{endsWith:function(suffix){return this.str?-1!==this.str.indexOf(suffix,this.str.length-suffix.length):this.str},toCamelCase:function(){return this.str?this.str.substring(0,1).toLowerCase()+this.str.substring(1):this.str},toPascalCase:function(){return this.str?this.str.substring(0,1).toUpperCase()+this.str.substring(1):this.str},until:function(remove){var target=glu.symbol(remove).toPascalCase(),trimAt=this.str.indexOf(target);return-1==trimAt?this.str:this.str.substring(0,trimAt)},split:function(){var name=this.str.replace(/([A-Z])/g,function(g){return"@"+g});return name.split("@")},asTitle:function(){var name=this.str.replace(/([A-Z])/g,function(g){return" "+g.toUpperCase()});return 0==name.indexOf(" ")&&(name=name.substring(1)),glu.string(name).toPascalCase()},flattenArgs:function(argsArray){var temp=[],i,j,subArgs;for(i=0;argsArray.length>i;i++)if("[object Array]"==Object.prototype.toString.call(argsArray[i]))for(subArgs=this.flattenArgs(argsArray[i]),j=0;subArgs.length>j;j++)temp.push(subArgs[j]);else temp.push(argsArray[i]);return temp},format:function(cfg){var args=arguments;return args=this.flattenArgs(args),glu.isObject(cfg)?this.str.replace(/{([\.\w]*?)}/g,function(token){for(var key=token.substring(1,token.length-1),value=void 0,i=0;args.length>i&&(value=glu.walk(key,args[i]),null==value);i++);if(void 0===value)throw Error("Need to supply value for named parameter "+key+" for this string substitution.");return value}):this.str.replace(/{(\d+)}/g,function(token,idx){var key=Number(token.substring(1,token.length-1));if(void 0===args[key])throw Error("Positional parameter "+token+" is out of range for this string substitution.");return args[idx]})}});